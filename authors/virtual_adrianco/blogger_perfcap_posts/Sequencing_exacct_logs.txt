Title: Sequencing exacct logs
URL: https://perfcap.blogspot.com/2005/04/sequencing-exacct-logs.html

I decided to simplify the next step and to just get raw data logged in a useful manner. To do this there needs to be a periodic process that generates readable log files. After thinking about this for a while, I think I have a simple and effective way to do it.<br /><br />I will modify the exdump code to add another option "-a". This will invoke acctadm to switch to a new set of log files, with a datestamped name. Before it does the switch, it will need to cause all current processes to write accounting entries, so "-a" will normally be used in conjunction with the "-w" option I added already. After the log switch, the old log files will be processed from their binary form to a text file with one record per line, ready for consumption by futher processing steps.<br />When "-a" is specified, a directory can be specified on the command line to hold output files, the input filename does not need to be specified as it was for the original version. This makes it easy to invoke exdump directly from cron without needing a wrapper script.<br /><br />The sequence is:<br /><pre><br />Obtain existing log files by running acctadm or reading /etc/acctadm.conf<br />Note which logs are being generated and their filenames<br />Run wracct on all existing processes<br />Run acctadm to switch to new log files with date-time-stamped names<br />Process existing log files to text form in the current directory or a <br />   specified directory using same base filenames<br /></pre><br />To start exacct the user needs to manually run acctadm once to enable the logs of interest (flow, task or proc) then exdump will generate the output logs at the cron interval. A find command can be used from cron to remove old logs and keep disk space managed.<br /><br />Since many commands run on the hour, it might be worth starting exdump a few seconds early, and have the file timestamp round up to the next minute so that any command sequences started from cron on the hour are less likely to get split up.<br /><br />This still leaves the problem of processing individual accounting records into useful data, but at least the one line per record text form with interval data will be more tractable than the binary file.