Title: Automated rotating exdump
URL: https://perfcap.blogspot.com/2005/04/automated-rotating-exdump.html

I've added an option that automates the processing of exacct data to text file format and rotates the logs, it is hard wired to create a new log file in /var/adm/exacct (which is an empty directory created during Solaris install as standard) and it includes the hostname and the date+time in the new file.<br /><br />The previous log name is used as the base of the output file, which is written to a specified directory with a .txt extension.<br /><br />The file /etc/acctadm.conf is maintained by the acctadm command, I read the log file names from it, and if there is no log file I don't start one. i.e. you need to manually start accounting with acctadm the first time to decide which logs you want to generate. The command syntax now looks like this:<br /><br /><span style="font-size:85%;"><span style="font-family:courier new;"># ./exdump</span><br /><span style="font-family:courier new;">Usage: exdump [-vwr] [<file> file | -a dir ]<br /></file></span></span><span style="font-size:85%;"><span style="font-family:courier new;"><dir></dir></span></span> <div style="text-align: left;"> <span style="font-family:courier new;font-size:85%;"> -v: verbose</span><span style="font-size:85%;"><br /></span><span style="font-family:courier new;font-size:85%;"> -w: wracct all processes first</span><span style="font-size:85%;"><br /></span><span style="font-family:courier new;font-size:85%;"> -r: rotate logs</span><span style="font-size:85%;"><br /></span><span style="font-family:courier new;font-size:85%;"> -a dir: use acctadm.conf to get input logs, and write output files to dir</span><br /></div> <span style="font-size:85%;"><span style="font-family:courier new;"> <dir></dir> </span></span><br /><span style=";font-family:georgia;font-size:100%;"  >The usual way to run the command will be from cron as shown</span><br /><span style="font-size:85%;"><span style="font-family:courier new;"> <dir></dir> </span></span> <div style="text-align: left;"><br /><span style="font-size:85%;"><span style="font-family:courier new;">0 * * * * /opt/exdump/exdump -war /var/tmp/exacct > /dev/null 2>&1</span></span><br /><span style="font-size:85%;"><span style="font-family:courier new;">2 * * * * /bin/find /var/adm/exacct -ctime +7 -exec rm {} \;</span></span><br /><br /><span style="font-size:100%;"><span style="font-family:georgia;">This also shows how to clean up old log files, I only delete the binary files in this example, and I created /var/tmp/exacct to hold the text files. The process data in the text file looks like this:</span></span><br /><br /><span style="font-size:78%;"><span style="font-family:courier new;">timestamp  locltime duration procid ppid uid   usr   sys majf rwKB vcxK icxK sigK sycK arMB mrMB command</span></span><br /><span style="font-size:78%;"><span style="font-family:courier new;">1114734370 17:26:10   0.0027 16527 16526   0 0.000 0.002    0 0.53 0.00 0.00 0.00  0.1  0.7 28.9 acctadm</span></span><br /><span style="font-size:78%;"><span style="font-family:courier new;">1114734370 17:26:10   0.0045 16526 16525   0 0.000 0.001    0 0.00 0.00 0.00 0.00  0.1  1.1 28.9 sh</span></span><br /><span style="font-size:78%;"><span style="font-family:courier new;">1114734370 17:26:10   0.0114 16525  8020   0 0.001 0.005    0 1.71 0.00 0.00 0.00  0.3  1.0 28.9 exdump</span></span><br /><span style="font-size:78%;"><span style="font-family:courier new;">1109786952 10:09:12  -1.0000     0     0   0 0.012 118.883  131 0.00 0.33 0.00 0.00  0.0  0.0  0.0 sched</span></span><br /><span style="font-size:78%;"><span style="font-family:courier new;">1109786952 10:09:12  -1.0000     0     0   0 0.012 118.883  131 0.00 0.33 0.00 0.00  0.0  0.0  0.0 sched</span></span><br /><span style="font-size:78%;"><span style="font-family:courier new;">1109786952 10:09:12  -1.0000     0     0   0 0.012 118.883  131 0.00 0.33 0.00 0.00  0.0  0.0  0.0 sched</span></span><br /><span style="font-size:78%;"><span style="font-family:courier new;">1109786959 10:09:19  -1.0000     1     0   0 4.311 3.066   96 47504.69 49.85 0.18 0.34 456.2  0.9  1.0 init</span></span><br /><span style="font-size:78%;"><span style="font-family:courier new;">1109786959 10:09:19  -1.0000     2     0   0 0.000 0.000    0 0.00 0.00 0.00 0.00  0.0  0.0  0.0 pageout</span></span><br /><br /><span style="font-size:100%;"><span style="font-family:georgia;">Since the -w option forced long running processes to write an accounting record they have not finished, and I chose to mark this by showing the duration as -1. One odd thing shown here is that the sched process generated three identical accounting records, this needs some more investigation.</span></span><br /><span style="font-size:100%;"> </span><br /><span style="font-size:100%;"> <span style="font-family:georgia;">I'm going to run this for a while, and install it on a few other machines including SPARC Solaris 10 and Solaris 8 to make sure its robust.</span></span><br /><span style="font-size:100%;"> </span><br /><br /></div> <span style="font-size:85%;"><span style="font-family:courier new;"> <dir><span style="font-size:78%;"><span style="font-family:courier new;"><span style="font-size:180%;"> </span><br /></span></span></dir> </span></span>